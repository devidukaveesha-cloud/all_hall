<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product | All Hall</title>
  <!-- Tailwind CSS CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts for "Inter" font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  
  <style>
    /* Basic body and font setup */
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: #0f0f0f url('wall.png') no-repeat center center fixed;
      background-size: cover;
      color: #eaeaea;
      padding-bottom: 80px; /* keep space for bottom nav */
    }
    
    .main-header {
      background: rgba(17, 17, 17, 0.9);
      color: #fff;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .logo a {
      color: #fff;
      font-size: 24px;
      font-weight: 800;
    }

    .search-bar {
      display: flex;
      flex-grow: 1;
      max-width: 500px;
    }

    .search-bar input {
      flex-grow: 1;
      padding: 8px 16px;
      border-radius: 9999px 0 0 9999px;
      border: 1px solid #333;
      background: #1f1f1f;
      color: #eaeaea;
      outline: none;
    }

    .search-bar button {
      background: #ffc400;
      color: #111;
      padding: 8px 16px;
      border-radius: 0 9999px 9999px 0;
      border: 1px solid #ffc400;
      cursor: pointer;
    }
    
    .header-icons a {
      color: #fff;
      font-size: 18px;
      margin-left: 12px;
    }

    .header-icons a:hover {
      color: #ffc400;
    }

    .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ff5252;
      color: #fff;
      font-size: 0.7rem;
      border-radius: 50%;
      padding: 2px 6px;
    }

    .main-nav {
      background: rgba(17, 17, 17, 0.9);
    }
    .main-nav a {
      color: #a1a1a1;
    }
    .main-nav a:hover, .main-nav a.active {
      color: #ffc400;
    }

    /* Product Page Specific Styles */
    .product-container {
      max-width: 1200px;
      margin: 24px auto;
      padding: 24px;
      background: rgba(17, 17, 17, 0.7);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    .product-image {
      width: 100%;
      max-height: 400px;
      object-fit: cover;
      border-radius: 16px;
    }

    .product-details h1 {
      font-size: 2.5rem;
      font-weight: 800;
      color: #ffc400;
    }

    .product-details .price {
      font-size: 1.5rem;
      font-weight: 600;
      color: #eaeaea;
    }

    .product-details .old-price {
      text-decoration: line-through;
      color: #a1a1a1;
      font-size: 1.25rem;
      margin-left: 8px;
    }

    .btn {
      padding: 12px 24px;
      font-weight: 600;
      border-radius: 9999px;
      transition: all 0.3s ease;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-add-to-cart {
      background: #ffc400;
      color: #111;
      border: none;
    }

    .btn-add-to-cart:hover {
      background: #ff9f00;
    }

    .btn-share {
      background: #2e2e2e;
      color: #ffc400;
      border: 1px solid #3d3d3d;
    }

    .btn-share:hover {
      background: #3d3d3d;
    }

    /* Reviews Section */
    .reviews-section {
      margin-top: 32px;
    }

    .review-card {
      background: rgba(23, 23, 23, 0.8);
      padding: 24px;
      border-radius: 16px;
      margin-top: 24px;
    }
    .review-card h3 {
      font-size: 1.25rem;
      font-weight: 600;
    }
    .review-card p {
      color: #a1a1a1;
    }

    .rating-stars {
      color: #ffc400;
      font-size: 1.5rem;
      margin-bottom: 8px;
    }

    .review-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-top: 24px;
    }

    .review-form textarea {
      padding: 12px;
      border-radius: 12px;
      background: #1f1f1f;
      color: #eaeaea;
      border: 1px solid #3d3d3d;
      min-height: 100px;
    }

    .review-form button {
      background: #ffc400;
      color: #111;
      padding: 12px 24px;
      border-radius: 9999px;
      font-weight: 600;
      cursor: pointer;
    }

    .review-photo-preview {
      margin-top: 16px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .review-photo-preview img {
      max-width: 150px;
      border-radius: 8px;
      object-fit: cover;
    }
    
    /* Toast/Message Box */
    #message-box {
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(30, 30, 30, 0.9);
        color: #fff;
        padding: 15px 30px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        text-align: center;
        transition: opacity 0.5s ease-in-out;
        opacity: 0;
    }
  </style>
</head>
<body class="bg-gray-900 text-gray-100 font-inter">

  <!-- Main Header -->
  <header class="main-header sticky top-0 z-50">
    <div class="logo">
      <a href="index.html">AllHall</a>
    </div>
    <div class="search-bar hidden sm:flex flex-grow max-w-lg mx-4">
      <input type="text" placeholder="Search for products..." class="flex-grow p-2 rounded-l-full bg-gray-800 border border-gray-700 focus:outline-none focus:border-yellow-400">
      <button class="bg-yellow-400 text-gray-900 p-2 rounded-r-full"><i class="fas fa-search"></i></button>
    </div>
    <div class="header-icons flex space-x-4">
      <a href="cart.html" title="Cart"><i class="fas fa-shopping-cart"></i><span class="badge cart-count">0</span></a>
      <a href="myorders.html" title="Orders" id="orders-link"><i class="fas fa-box"></i></a>
      <a href="login.html" title="Login" id="login-link"><i class="fas fa-user"></i></a>
      <a href="account.html" title="Account" class="hidden" id="account-link"><i class="fas fa-user"></i></a>
    </div>
  </header>

  <main class="product-container">
    <div id="product-details-content">
      <!-- Product details will be dynamically injected here by the script -->
      <h1 class="text-3xl text-center text-gray-500">Loading Product...</h1>
    </div>
  </main>
  
  <!-- A small message box to replace alerts -->
  <div id="message-box" style="display:none;"></div>

  <!-- Bottom Navigation Bar -->
  <nav class="main-nav flex justify-around items-center p-3 text-sm sm:text-base sticky bottom-0 z-10 w-full rounded-t-3xl shadow-[0_-4px_12px_rgba(0,0,0,0.2)]">
    <a href="index.html" class="flex flex-col items-center text-gray-400 hover:text-[#ffc400] transition-colors p-2 rounded-lg">
      <i class="fas fa-home text-xl"></i>
      <span class="mt-1 text-xs sm:text-sm">Home</span>
    </a>
    <a href="cart.html" class="flex flex-col items-center text-gray-400 hover:text-[#ffc400] transition-colors p-2 rounded-lg">
      <i class="fas fa-shopping-cart text-xl"></i>
      <span class="mt-1 text-xs sm:text-sm">Cart</span>
    </a>
    <a href="myorders.html" class="flex flex-col items-center text-gray-400 hover:text-[#ffc400] transition-colors p-2 rounded-lg" id="myorders-link">
      <i class="fas fa-box text-xl"></i>
      <span class="mt-1 text-xs sm:text-sm">Orders</span>
    </a>
    <a href="seller_center.html" id="seller-link" class="flex flex-col items-center text-gray-400 hover:text-[#ffc400] transition-colors p-2 rounded-lg">
      <i class="fas fa-store text-xl"></i>
      <span class="mt-1 text-xs sm:text-sm">Seller</span>
    </a>
    <a href="account.html" class="flex flex-col items-center text-gray-400 hover:text-[#ffc400] transition-colors p-2 rounded-lg" id="account-link">
      <i class="fas fa-user text-xl"></i>
      <span class="mt-1 text-xs sm:text-sm">Account</span>
    </a>
  </nav>

  <!-- Import app.js with type="module" -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    // IMPORTANT: These variables are provided by the canvas environment.
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
    
    // Initialize Firebase App
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    let userId = null;
    let isAuthReady = false;

    onAuthStateChanged(auth, async (user) => {
      if (user) {
          userId = user.uid;
          isAuthReady = true;
          // Start rendering once authenticated
          renderProductPage();
          hideSellerLinkBasedOnRole();
      } else {
          if (!isAuthReady) {
              await signInAnonymously(auth);
          }
      }
    });

    const collections = {
        products: `artifacts/${appId}/public/data/products`,
    };

    function toast(message, duration = 3000) {
      const toastEl = document.getElementById('message-box');
      if (toastEl) {
        toastEl.textContent = message;
        toastEl.style.display = 'block';
        setTimeout(() => {
          toastEl.style.display = 'none';
        }, duration);
      }
    }
    
    async function renderProductPage() {
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get('id');
      const productContent = document.getElementById('product-details-content');

      if (!productId) {
        productContent.innerHTML = '<p class="text-center text-red-500">Product not found.</p>';
        return;
      }
      
      const productRef = doc(db, collections.products, productId);
      const productDoc = await getDoc(productRef);

      if (productDoc.exists()) {
        const product = { id: productDoc.id, ...productDoc.data() };
        productContent.innerHTML = `
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="product-image-container">
              <img src="${product.img}" alt="${product.name}" class="product-image">
            </div>
            <div class="product-details">
              <h1>${product.name}</h1>
              <p class="text-gray-400">${product.desc}</p>
              <div class="flex items-center mt-2">
                <span class="text-xl font-bold text-yellow-400">
                  ${'&#9733;'.repeat(Math.round(product.rating))}
                </span>
                <span class="text-gray-400 ml-2">(${product.rating} / 5)</span>
              </div>
              <div class="flex items-baseline my-4">
                <span class="price">$${product.price.toFixed(2)}</span>
                ${product.oldPrice ? `<span class="old-price">$${product.oldPrice.toFixed(2)}</span>` : ''}
              </div>

              <!-- Product Options (Colors, Sizes) - Placeholder -->
              <div class="my-6">
                <h3 class="text-lg font-semibold mb-2">Color</h3>
                <div class="flex gap-2">
                  ${product.colors ? product.colors.map(color => `<span class="px-4 py-2 rounded-full border border-gray-600 text-xs">${color}</span>`).join('') : ''}
                </div>
              </div>
              <div class="my-6">
                <h3 class="text-lg font-semibold mb-2">Size</h3>
                <div class="flex gap-2">
                  ${product.sizes ? product.sizes.map(size => `<span class="px-4 py-2 rounded-full border border-gray-600 text-xs">${size}</span>`).join('') : ''}
                </div>
              </div>

              <div class="flex flex-col sm:flex-row gap-4">
                <button class="btn btn-add-to-cart flex-1" data-product-id="${product.id}">
                  <i class="fas fa-shopping-cart"></i> Add to Cart
                </button>
                <button class="btn btn-share flex-1" onclick="shareProduct()">
                  <i class="fas fa-share-alt"></i> Share
                </button>
              </div>
            </div>
          </div>

          <section class="reviews-section">
            <h2 class="text-2xl font-bold text-yellow-400">Customer Reviews</h2>
            <div id="reviews-list" class="space-y-4">
              <p class="text-center text-gray-400 mt-4">No reviews yet. Be the first!</p>
            </div>
            <form id="review-form" class="review-form">
              <textarea placeholder="Write your review here..."></textarea>
              <button type="submit">Submit Review</button>
            </form>
          </section>
        `;
      } else {
        productContent.innerHTML = '<p class="text-center text-red-500">Product not found.</p>';
      }
    }

    // Share Button
    function shareProduct() {
        const tempInput = document.createElement("input");
        tempInput.value = window.location.href;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        toast("Product link copied!");
    }
    
    // Dummy function for hiding/showing the seller link, since we need it on every page.
    async function hideSellerLinkBasedOnRole() {
        const sellerLink = document.getElementById('seller-link');
        const loginLink = document.getElementById('login-link');
        const accountLink = document.getElementById('account-link');

        if (sellerLink) {
          sellerLink.style.display = 'flex';
        }
        if (loginLink) {
            loginLink.style.display = 'none';
        }
        if (accountLink) {
            accountLink.style.display = 'flex';
        }
    }

  </script>
  <script type="module" src="app.js"></script>
</body>
</html>
